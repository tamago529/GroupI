{% load static %}
<style>
  .header-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  /* ... (ä¸­ç•¥ï¼šæ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©) ... */
  .nav-left {
    display: flex; 
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .nav-user-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border: 1px solid #d9d9d9;
    border-radius: 999px;
    background: #fff;
    color: #333;
    font-size: 12px;
    line-height: 1;
    white-space: nowrap;
  }

  .nav-user-dot {
    width: 9px;
    height: 9px;
    border-radius: 50%;
    background: #22c55e;
    /* ãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šç·‘ */
    box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.18);
    flex: 0 0 auto;
  }

  .nav-user-dot.is-guest {
    background: #9ca3af;
    /* æœªãƒ­ã‚°ã‚¤ãƒ³ï¼šã‚°ãƒ¬ãƒ¼ */
    box-shadow: 0 0 0 2px rgba(156, 163, 175, 0.18);
  }

  .nav-user-sub {
    color: #666;
    font-size: 11px;
  }

  .nav-user-name {
    font-weight: bold;
    color: #111;
  }

  /* =========================
     ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼
  ========================= */
  .menu-wrap {
    position: relative;
    display: inline-flex;
    align-items: center;
  }

  .hamburger-btn {
    width: 40px;
    height: 36px;
    border: 1px solid #d9d9d9;
    background: #fff;
    border-radius: 8px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }

  .hamburger-btn:hover {
    opacity: .92;
  }

  .hamburger-icon {
    width: 18px;
    height: 12px;
    position: relative;
    display: block;
  }

  .hamburger-icon::before,
  .hamburger-icon::after,
  .hamburger-icon span {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: #333;
    border-radius: 2px;
  }

  .hamburger-icon::before {
    top: 0;
  }

  .hamburger-icon span {
    top: 5px;
  }

  .hamburger-icon::after {
    bottom: 0;
  }

  .menu-panel {
    position: absolute;
    right: 0;
    top: 44px;
    min-width: 220px;
    background: #fff;
    border: 1px solid #e5e5e5;
    box-shadow: 0 10px 25px rgba(0, 0, 0, .12);
    border-radius: 10px;
    padding: 8px;
    display: none;
    z-index: 9999;
  }

  .menu-panel.is-open {
    display: block;
  }

  .menu-item {
    display: block;
    padding: 10px 10px;
    border-radius: 8px;
    color: #111;
    text-decoration: none;
    font-size: 13px;
    line-height: 1.2;
  }

  .menu-item:hover {
    background: #f4f4f2;
  }

  .menu-sep {
    height: 1px;
    background: #eee;
    margin: 6px 4px;
  }

  .menu-form {
    margin: 0;
  }

  .menu-btn {
    width: 100%;
    text-align: left;
    border: none;
    background: transparent;
    padding: 10px 10px;
    border-radius: 8px;
    cursor: pointer;
    font: inherit;
    font-size: 13px;
    color: #111;
  }

  .menu-btn:hover {
    background: #f4f4f2;
  }
</style>

<header class="header">

  <!-- ä¸Šæ®µï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div class="header-top">
    <nav class="header-nav">

      <div class="nav-left">
        {# âœ… å¸¸ã«è¡¨ç¤ºï¼šæœªãƒ­ã‚°ã‚¤ãƒ³ã¯ã‚²ã‚¹ãƒˆ #}
        <span class="nav-user-badge" aria-label="ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹">
          <span class="nav-user-dot {% if not user.is_authenticated %}is-guest{% endif %}" aria-hidden="true"></span>
          <span class="nav-user-sub">ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼š</span>
          <span class="nav-user-name">
            {% if user.is_authenticated %}{{ user.username }}{% else %}ã‚²ã‚¹ãƒˆ{% endif %}
          </span>
        </span>
      </div>

      <div class="nav-right">
        <div class="menu-wrap">
          <button type="button" class="hamburger-btn" id="hamburgerBtn" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã" aria-expanded="false">
            <span class="hamburger-icon"><span></span></span>
          </button>

          <div class="menu-panel" id="menuPanel" role="menu" aria-label="ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
            {% if not user.is_authenticated %}
            {# âœ… æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šãƒ­ã‚°ã‚¤ãƒ³3ã¤ã ã‘è¡¨ç¤º #}
            <a class="menu-item" href="{% url 'accounts:customer_login' %}" role="menuitem">é¡§å®¢ãƒ­ã‚°ã‚¤ãƒ³</a>
            <a class="menu-item" href="{% url 'accounts:store_login' %}" role="menuitem">åº—èˆ—ãƒ­ã‚°ã‚¤ãƒ³</a>
            <a class="menu-item" href="{% url 'accounts:company_login' %}" role="menuitem">ä¼æ¥­ãƒ­ã‚°ã‚¤ãƒ³</a>
            {% else %}
            {# âœ… ãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼šé€šå¸¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼ + ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ #}
            <a class="menu-item" href="{% url 'accounts:customer_setting' %}" role="menuitem">è¨­å®š</a>
            <a class="menu-item" href="#" role="menuitem">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</a>
            <a class="menu-item" href="#" role="menuitem">ãŠçŸ¥ã‚‰ã›</a>
            <a class="menu-item" href="{% url 'reservations:store_reservation_history' %}" role="menuitem">äºˆç´„ç¢ºèª</a>
            <a class="menu-item" href="#" role="menuitem">è¡Œã£ãŸãŠåº—</a>
            <a class="menu-item" href="{% url 'reviews:customer_store_preserve' %}" role="menuitem">ä¿å­˜ãƒªã‚¹ãƒˆ</a>
            <a class="menu-item" href="{% url 'reviews:customer_reviewer_detail' %}" role="menuitem">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>

            <div class="menu-sep"></div>

            <a class="menu-item" href="{% url 'accounts:customer_logout' %}" role="menuitem">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            {% endif %}
          </div>
        </div>
      </div>

    </nav>
  </div>

  <!-- ä¸‹æ®µï¼šãƒ­ã‚´ï¼‹æ¤œç´¢ãƒãƒ¼ -->
  <div class="header-bottom">
    <div class="logo">
      <a href="{% url 'accounts:customer_top' %}">
        <img src="{% static 'images/Tabecchi.png' %}" alt="Tabecchi Logo">
      </a>
    </div>

    <form class="search-bar" method="get" action="{% url 'search:customer_search_list' %}">
      <input type="text" name="area" placeholder="ã‚¨ãƒªã‚¢ãƒ»é§…ï¼ˆä¾‹ï¼šéŠ€åº§ã€æ¸‹è°·ï¼‰" value="{{ request.GET.area }}">
      <input type="text" name="keyword" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼šç„¼è‚‰ã€å€‹å®¤ï¼‰" value="{{ request.GET.keyword }}">
      <input type="date" name="date" value="{{ request.GET.date }}">
      <input type="time" name="time" value="{{ request.GET.time }}">

      <select name="people">
        <option value="1" {% if request.GET.people == "1" %}selected{% endif %}>1å</option>
        <option value="2" {% if request.GET.people == "2" %}selected{% endif %}>2å</option>
        <option value="3" {% if request.GET.people == "3" %}selected{% endif %}>3å</option>
        <option value="4" {% if request.GET.people == "4" %}selected{% endif %}>4å</option>
      </select>

      <button type="submit" class="search-btn">ğŸ”</button>
    </form>
  </div>
</header>

<script>
  (function () {
    const btn = document.getElementById('hamburgerBtn');
    const panel = document.getElementById('menuPanel');

    if (!btn || !panel) return;

    function closeMenu() {
      panel.classList.remove('is-open');
      btn.setAttribute('aria-expanded', 'false');
    }
    function toggleMenu() {
      const isOpen = panel.classList.contains('is-open');
      if (isOpen) closeMenu();
      else {
        panel.classList.add('is-open');
        btn.setAttribute('aria-expanded', 'true');
      }
    }

    btn.addEventListener('click', function (e) {
      e.stopPropagation();
      toggleMenu();
    });

    panel.addEventListener('click', function (e) {
      e.stopPropagation();
    });

    document.addEventListener('click', function () {
      closeMenu();
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') closeMenu();
    });
  })();
</script>