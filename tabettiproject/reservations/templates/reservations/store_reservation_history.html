{% extends "customer_base.html" %}

{% block breadcrumb %}
<nav class="breadcrumbs">
  <ol>
    <li><a href="{% url 'accounts:customer_top' %}">トップ</a></li>
    <li><span>予約履歴</span></li>
  </ol>
</nav>
{% endblock %}

{% block content %}

<style>
  /* ★ 色合い・デザインは一切変更していません（そのまま） */
  :root{
    --bg:#f6f6f6;
    --card:#fff;
    --line:#e6e0d7;
    --text:#333;
    --sub:#666;
    --link:#1a73e8;
    --brand:#d86b00;
    --head:#f2efe9;
    --soft:#faf8f4;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Hiragino Kaku Gothic ProN","Meiryo",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  .wrap{max-width:980px;margin:0 auto;padding:14px 16px 40px;}
  .breadcrumb{font-size:12px;color:#777;margin:10px 0 12px;}
  .breadcrumb a{color:#777;text-decoration:none;}
  .page-title{background:var(--card);border:1px solid var(--line);padding:14px 16px;font-size:18px;font-weight:900;}
  .info-link{margin:10px 0 0;text-align:right;font-size:12px;color:var(--sub);}
  .info-link a{color:var(--link);text-decoration:none;font-weight:800;}
  .section{margin-top:14px;background:var(--card);border:1px solid var(--line);}
  .section-head{background:var(--head);border-bottom:1px solid var(--line);padding:10px 14px;font-weight:900;font-size:13px;}
  .section-body{padding:16px 14px;}
  .empty-box{background:var(--soft);border:1px solid var(--line);padding:14px;text-align:center;color:var(--sub);font-size:12px;}
  .list{display:flex;flex-direction:column;gap:10px;}
  .item{border:1px solid var(--line);border-radius:6px;background:#fff;padding:12px;display:flex;gap:12px;}
  .thumb{width:70px;height:70px;border-radius:6px;background:#ddd;flex:0 0 70px;}
  .main{flex:1;min-width:0;}
  .title{font-weight:900;font-size:14px;margin-bottom:6px;color:#0b63d1;}
  .meta{font-size:12px;color:var(--sub);line-height:1.7;}
  .badges{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;}
  .badge{border:1px solid #cfc8bd;padding:4px 8px;border-radius:999px;font-size:11px;font-weight:900;}
  .actions{margin-left:auto;display:flex;flex-direction:column;gap:8px;}
  .btn{height:36px;min-width:170px;border-radius:4px;border:1px solid #cfc8bd;background:#fff;font-weight:900;font-size:12px;display:flex;align-items:center;justify-content:center;text-decoration:none;color:#333;}
  .btn-primary{border:none;background:var(--brand);color:#fff;}
  
  /* Pagination (Match Search List) */
  .pagination {
    text-align: center;
    margin: 32px 0;
  }
  .pagination a {
    margin: 0 6px;
    color: var(--brand); /* Match reservation list orange/brand color */
    text-decoration: none;
    font-size: 14px;
  }
  .pagination a:hover {
    text-decoration: underline;
  }
  .pagination .current {
    margin: 0 6px;
    font-weight: bold;
    color: #fff;
    background: var(--brand);
    padding: 4px 10px;
    border-radius: 20px;
    display: inline-block;
    font-size: 14px;
  }
  .pagination .ellipsis {
    margin: 0 6px;
    color: #666;
  }
</style>



<div class="wrap">

  <div class="page-title">予約履歴</div>

  <div class="info-link">
    <span>予約中・来店済みなどのステータスについては</span>
    <a href="#">こちら</a>
    <span>をご確認ください。</span>
  </div>

  <div class="section">
    
    <div class="section-body">

      {% if reservations %}
        <div class="list">
          {% for r in reservations %}
            <div class="item">

              <!-- サムネ（未設定時はグレー） -->
              {% with img=r.store.images.all.0 %}
                {% if img and img.image_file %}
                  <img class="thumb" src="{{ img.image_file.url }}" alt="{{ r.store.store_name }}">
                {% else %}
                  <div class="thumb"></div>
                {% endif %}
              {% endwith %}

              <div class="main">
                <div class="title">{{ r.store.store_name }}</div>

                <div class="meta">
                  来店日：{{ r.visit_date|date:"Y年n月j日(D)" }}<br>
                  来店時刻：{{ r.visit_time|time:"H:i" }} ／ 人数：{{ r.visit_count }}名<br>
                  コース：{{ r.course }}
                </div>

                <div class="badges">
                  <span class="badge">ステータス：{{ r.booking_status.status }}</span>
                  <span class="badge">予約ID：{{ r.id }}</span>
                </div>
              </div>

              <div class="actions">
                <a class="btn btn-primary" href="{% url 'reservations:store_reservation_confirm' r.id %}">
                  予約内容を確認
                </a>
                <a class="btn" href="{% url 'stores:customer_store_info' r.store_id %}">
                  店舗ページ
                </a>
              </div>

            </div>
          {% endfor %}
        </div>

        {% if reservations.paginator.num_pages > 1 %}
          <div class="pagination">
            {% if reservations.has_previous %}
              <a href="?page={{ reservations.previous_page_number }}">前へ</a>
            {% endif %}

            {% for num in page_range %}
              {% if num == reservations.paginator.ELLIPSIS %}
                <span class="ellipsis">{{ num }}</span>
              {% elif reservations.number == num %}
                <span class="current">{{ num }}</span>
              {% else %}
                <a href="?page={{ num }}">{{ num }}</a>
              {% endif %}
            {% endfor %}

            {% if reservations.has_next %}
              <a href="?page={{ reservations.next_page_number }}">次へ</a>
            {% endif %}
          </div>
        {% endif %}
      {% else %}
        <div class="empty-box">
          現在、ご予約中のレストランはありません。
        </div>
      {% endif %}

    </div>
  </div>
</div>

{% endblock %}
