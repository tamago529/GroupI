{% extends "customer_base.html" %}
{% block content %}

<style>
  :root{
    --bg:#f6f6f6;
    --card:#ffffff;
    --line:#e6e0d7;
    --head:#f2efe9;
    --soft:#faf8f4;
    --text:#333;
    --sub:#666;
    --link:#1a73e8;
    --green:#6fbf2f;
    --green-dark:#4ea318;
    --warn-bg:#fde8e8;
    --warn:#c8342a;
    --shadow: 0 1px 0 rgba(0,0,0,.03);
  }
  *{box-sizing:border-box}

  .wrap{
    max-width:980px;
    margin:0 auto;
    padding:18px 16px 40px;
    color:var(--text);
  }

  .page-title{
    background:var(--card);
    border:1px solid var(--line);
    padding:14px 16px;
    font-size:18px;
    font-weight:800;
    box-shadow:var(--shadow);
  }

  .shop-card{
    margin-top:12px;
    background:var(--card);
    border:1px solid var(--line);
    padding:14px;
    display:flex;
    gap:14px;
    align-items:center;
    border-radius:4px;
    box-shadow:var(--shadow);
  }
  .thumb{
    width:72px;
    height:72px;
    border-radius:4px;
    background:#ddd;
    flex:0 0 72px;
    overflow:hidden;
  }
  .thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .shop-info{
    flex:1;
    min-width:0;
  }
  .shop-name{
    font-weight:900;
    font-size:14px;
    margin:0 0 6px;
    color:#0b63d1;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    text-decoration:none;
    display:inline-block;
  }
  .shop-name:hover{text-decoration:underline}
  .shop-meta{
    font-size:12px;
    color:var(--sub);
    line-height:1.6;
  }

  .section{
    margin-top:14px;
    background:var(--card);
    border:1px solid var(--line);
    box-shadow:var(--shadow);
  }
  .section-head{
    padding:10px 14px;
    background:var(--head);
    border-bottom:1px solid var(--line);
    font-weight:900;
    font-size:13px;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .caret{
    width:0;height:0;
    border-left:5px solid transparent;
    border-right:5px solid transparent;
    border-top:7px solid #333;
    transform:translateY(1px);
  }
  .section-body{
    padding:14px;
  }

  .help{
    font-size:12px;
    color:var(--sub);
    margin:0 0 10px;
    line-height:1.6;
  }

  .form-row{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
    margin-bottom:10px;
  }
  .form-row label{
    font-size:12px;
    color:#333;
    font-weight:800;
    min-width:52px;
  }

  input[type="text"], input[type="number"], input[type="time"], input[type="date"], select, textarea{
    border:1px solid #d7d2c9;
    border-radius:4px;
    padding:9px 10px;
    font-size:13px;
    background:#fff;
    outline:none;
  }
  input:focus, select:focus, textarea:focus{
    border-color:#9aa7b5;
    box-shadow:0 0 0 2px rgba(26,115,232,.12);
  }

  .w-date{width:170px}
  .w-time{width:120px}
  .w-people{width:110px}
  .w-course{min-width:220px}

  .warn{
    margin-top:14px;
    padding:10px 12px;
    border:1px solid #f2b8b8;
    background:var(--warn-bg);
    color:var(--warn);
    font-size:12px;
    line-height:1.6;
  }

  .actions{
    margin-top:12px;
    display:flex;
    justify-content:center;
    gap:14px;
    flex-wrap:wrap;
  }
  .btn{
    min-width:260px;
    height:44px;
    border-radius:4px;
    border:1px solid #cfc8bd;
    background:#fff;
    font-weight:900;
    cursor:pointer;
    font-size:13px;
  }
  .btn:hover{background:#f3f3f3}
  .btn-green{
    border:none;
    background:var(--green);
    color:#fff;
  }
  .btn-green:hover{background:var(--green-dark)}

  @media (max-width: 720px){
    .btn{min-width:100%}
  }
</style>

<div class="wrap">

  <div class="page-title">ご予約内容の変更</div>

  <div class="shop-card">
    <div class="shop-info">
      <a class="shop-name" href="{{ store_page_url }}">{{ reservation.store.store_name }}</a>
      <div class="shop-meta">
        {{ reservation.visit_date|date:"Y年 n月 j日(D)" }}
        {{ reservation.visit_time|time:"H:i" }}
        ／ {{ reservation.visit_count }}名<br>
        コース：{{ reservation.course }}
      </div>
    </div>
  </div>

  <form method="post" action="">
    {% csrf_token %}

    <div class="section">
      <div class="section-head"><span class="caret"></span>ご来店日時・人数の変更</div>

      <div class="section-body">
        <p class="help">ご希望の来店日・時間・人数を変更してください。</p>

        <div class="form-row">
          <label for="visit_date">来店日</label>
          <input id="visit_date" name="visit_date" class="w-date" type="date"
                 value="{{ reservation.visit_date|date:'Y-m-d' }}" required>

          <label for="visit_time">時間</label>
          <input id="visit_time" name="visit_time" class="w-time" type="time"
                 value="{{ reservation.visit_time|time:'H:i' }}" required>

          <label for="visit_count">人数</label>
          <select id="visit_count" name="visit_count" class="w-people" required>
            <option value="1" {% if reservation.visit_count == 1 %}selected{% endif %}>1名</option>
            <option value="2" {% if reservation.visit_count == 2 %}selected{% endif %}>2名</option>
            <option value="3" {% if reservation.visit_count == 3 %}selected{% endif %}>3名</option>
            <option value="4" {% if reservation.visit_count == 4 %}selected{% endif %}>4名</option>
            <option value="5" {% if reservation.visit_count == 5 %}selected{% endif %}>5名</option>
            <option value="6" {% if reservation.visit_count == 6 %}selected{% endif %}>6名</option>
            <option value="7" {% if reservation.visit_count == 7 %}selected{% endif %}>7名</option>
            <option value="8" {% if reservation.visit_count == 8 %}selected{% endif %}>8名</option>
            <option value="9" {% if reservation.visit_count == 9 %}selected{% endif %}>9名</option>
            <option value="10" {% if reservation.visit_count == 10 %}selected{% endif %}>10名</option>
          </select>
        </div>

        <div class="form-row" style="margin-top:6px;">
          <label for="course_minutes">コース</label>
          <select id="course_minutes" name="course_minutes" class="w-course" required>
              <option value="30"  {% if reservation.course == "30分コース" %}selected{% endif %}>30分コース</option>
              <option value="60"  {% if reservation.course == "1時間コース" %}selected{% endif %}>1時間コース</option>
              <option value="90"  {% if reservation.course == "1時間30分コース" %}selected{% endif %}>1時間30分コース</option>
              <option value="120" {% if reservation.course == "2時間コース" %}selected{% endif %}>2時間コース</option>
              <option value="150" {% if reservation.course == "2時間30分コース" %}selected{% endif %}>2時間30分コース</option>
          </select>
        </div>


        <div class="actions" style="padding:14px;">
          <button type="button" class="btn"
                  onclick="location.href='{% url 'reservations:store_reservation_confirm' reservation.id %}';">
            ご予約内容の確認へ戻る
          </button>
          <button type="submit" class="btn btn-green">この内容で変更する</button>
        </div>
      </div>
    </div>
  </form>
</div>

{% endblock %}
