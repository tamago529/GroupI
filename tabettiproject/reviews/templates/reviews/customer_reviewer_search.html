{% extends 'customer_base.html' %}

{% block title %}レビュアー検索画面{% endblock %}

{% block css %}
<style>
    /* ============================================================
       全体のレイアウト・背景
       ============================================================ */
    body {
        background-color: #fbfbf8;
        color: #333;
        font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
        font-size: 13px;
        line-height: 1.5;
    }

    .ranking-container {
        max-width: 980px;
        margin: 0 auto;
        padding-bottom: 50px;
    }

    /* パンくずリスト */
    .breadcrumb {
        font-size: 11px;
        margin: 10px 0;
        color: #06c;
    }

    .breadcrumb a {
        color: #06c;
        text-decoration: none;
    }

    /* メインとサイドバーの横並び */
    .ranking-wrapper {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }

    /* ============================================================
       メインコンテンツ（左側）
       ============================================================ */
    .ranking-main {
        flex: 1;
        background-color: #fff;
        border: 1px solid #e6e6e2;
        padding: 20px;
    }

    /* 検索バーセクション（実機に合わせ背景色と枠線を調整） */
    .search-section {
        background-color: #f2f2ee;
        padding: 15px;
        border: 1px solid #e6e6e2;
        margin-bottom: 25px;
        display: flex;
    }

    .search-section input {
        flex: 1;
        border: 1px solid #ccc;
        padding: 8px;
        font-size: 14px;
        outline: none;
    }

    .search-section button {
        background-color: #83a700;
        color: #fff;
        border: none;
        padding: 0 20px;
        font-weight: bold;
        cursor: pointer;
        font-size: 14px;
    }

    /* ランク概要（月間・年間の分割ボックス） */
    .summary-box {
        border: 1px solid #e6e6e2;
        display: flex;
        margin-bottom: 10px;
        border-radius: 4px;
    }

    .summary-item {
        flex: 1;
        padding: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .summary-item:first-child {
        border-right: 1px solid #e6e6e2;
    }

    .summary-date {
        font-size: 18px;
        font-weight: bold;
        margin-right: 20px;
        min-width: 80px;
    }

    .summary-details {
        flex: 1;
        text-align: center;
        background-color: #fcfcfc;
        border: 1px solid #f0f0ed;
        padding: 10px;
    }

    .summary-rank-text {
        font-size: 10px;
        color: #999;
    }

    .summary-rank-val {
        font-size: 20px;
        font-weight: bold;
        margin: 2px 0;
    }

    .summary-hint {
        font-size: 11px;
        color: #83a700;
        margin-top: 5px;
    }

    /* セクション見出し（オレンジの縦線） */
    .section-headline {
        border-left: 4px solid #f60;
        padding-left: 10px;
        font-weight: bold;
        font-size: 15px;
        margin: 30px 0 15px;
        display: flex;
        align-items: center;
    }

    /* レビュアーグリッド（5列） */
    .reviewer-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 20px 10px;
        margin-bottom: 15px;
    }

    .reviewer-item {
        text-align: center;
        position: relative;
    }

    .reviewer-img {
        border: 1px solid #e6e6e2;
        object-fit: cover;
        /* エラー対策：HTML属性で指定するがCSSでも定義 */
        width: 90px;
        height: 90px;
    }

    .rank-badge {
        position: absolute;
        top: -4px;
        left: 5px;
        background-color: #bfa541;
        /* 金色 */
        color: #fff;
        font-size: 10px;
        font-weight: bold;
        padding: 1px 5px;
    }

    .rank-badge.silver {
        background-color: #a8a8a8;
    }

    .reviewer-name {
        color: #06c;
        font-weight: bold;
        font-size: 11px;
        display: block;
        margin-top: 5px;
        text-decoration: none;
    }

    .count-val {
        font-weight: bold;
        font-size: 13px;
    }

    /* 地域・ジャンルリンク集（テーブル） */
    .link-section {
        margin-top: 40px;
    }

    .link-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        border-top: 1px solid #e6e6e2;
    }

    /* エラー対策：アクセシブルな名前の提供 */
    .link-table caption {
        clip: rect(1px, 1px, 1px, 1px);
        height: 1px;
        overflow: hidden;
        position: absolute;
        width: 1px;
    }

    .link-table th {
        width: 130px;
        text-align: left;
        padding: 12px 10px;
        background-color: #fff;
        color: #666;
        vertical-align: top;
        border-bottom: 1px dotted #ccc;
    }

    .link-table td {
        padding: 12px 10px;
        border-bottom: 1px dotted #ccc;
        line-height: 1.8;
    }

    .link-table a {
        color: #06c;
        margin-right: 12px;
        text-decoration: none;
    }

    .link-table a:hover {
        text-decoration: underline;
    }

    /* ============================================================
       サイドバー（右側）
       ============================================================ */
    .ranking-sidebar {
        width: 240px;
    }

    .sidebar-box {
        background-color: #fff;
        border: 1px solid #e6e6e2;
        padding: 15px;
        margin-bottom: 20px;
    }

    .user-profile {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .profile-img-placeholder {
        width: 40px;
        height: 40px;
        background-color: #eee;
        border: 1px solid #ccc;
        margin-right: 10px;
    }

    .sidebar-nav-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar-nav-list li {
        border-bottom: 1px dotted #ccc;
        padding: 10px 0;
        display: flex;
        justify-content: space-between;
    }

    .sidebar-nav-list a {
        color: #06c;
        text-decoration: none;
        font-size: 13px;
    }

    .premium-card {
        background-color: #fffce6;
        border: 1px solid #f2e699;
        padding: 10px;
        margin-top: 15px;
        text-align: center;
    }

    .premium-btn {
        background-color: #b50044;
        color: #fff;
        border: none;
        width: 100%;
        padding: 10px;
        font-weight: bold;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }
</style>
{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumbs">
    <ol>
        <li><a href="{% url 'accounts:customer_top' %}">トップ</a></li>
        <li><span>レビュアー検索</span></li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="ranking-container">
    <div class="ranking-wrapper">
        <main class="ranking-main">
            <section class="search-section">
                <form method="get" action="{% url 'reviews:customer_reviewer_search' %}" style="display: flex; width: 100%;">
                    <input type="text" name="keyword" placeholder="全国のレビュアーから探す [例:食べログ太郎]" value="{{ keyword }}">
                    <button type="submit">検索</button>
                </form>
            </section>

            {% if keyword %}
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 15px;">
                「{{ keyword }}」の検索結果
            </h2>

            <div style="font-size: 13px; margin: 15px 0 10px;">
                <strong>全 {{ result_count }}</strong> 件
            </div>

            {% if search_results %}
            <div style="margin-top: 20px;">
                {% for review in search_results %}
                <article style="border-top:1px dotted #ccc; padding: 16px 0;">
                    <div style="display:flex; justify-content:space-between; gap:12px;">
                        <div style="min-width:0; flex: 1;">
                            <div style="font-weight:bold; font-size:15px;">
                                <a href="{% url 'stores:customer_store_info' review.store.pk %}" style="color: #06c; text-decoration: none;">
                                    {{ review.store.store_name }}{% if review.store.branch_name %} {{ review.store.branch_name }}{% endif %}
                                </a>
                            </div>

                            <div style="font-size:12px; color:#666; margin-top:4px;">
                                投稿者：<a href="{% url 'follows:customer_user_page' review.reviewer.pk %}" style="color: #06c; text-decoration: none;">{{ review.reviewer.nickname }}</a> ／ 
                                投稿日：{{ review.posted_at|date:"Y/m/d H:i" }} ／ 
                                評価：{{ review.score }}
                            </div>

                            {% if review.review_title %}
                            <div style="font-weight: bold; font-size: 14px; margin-top: 8px;">
                                {{ review.review_title }}
                            </div>
                            {% endif %}

                            <div style="font-size:13px; margin-top:8px; line-height:1.6;">
                                {{ review.review_text|truncatewords:30|linebreaksbr }}
                            </div>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <div style="padding:20px; color:#666; text-align: center;">
                検索結果が見つかりませんでした。
            </div>
            {% endif %}

            {% else %}
            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 15px;">口コミ検索</h2>
            <p style="color: #666; font-size: 13px;">キーワードを入力して口コミを検索してください。</p>

            {% if not keyword %}
            <div class="summary-box">
                <div class="summary-item">
                    <div class="summary-date">2026年1月</div>
                    <div class="summary-details">
                        <div class="summary-rank-text">TOP100位</div>
                        <div class="summary-rank-val">圏外</div>
                        <div style="font-size: 11px;">口コミ数 0件</div>
                        <div class="summary-hint">あと2件口コミ投稿したらランクインします!</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-date">年間</div>
                    <div class="summary-details">
                        <div class="summary-rank-text">TOP100位</div>
                        <div class="summary-rank-val">圏外</div>
                        <div style="font-size: 11px;">口コミ数 5件</div>
                        <div class="summary-hint">あと30件口コミ投稿したらランクインします!</div>
                    </div>
                </div>
            </div>
            <p style="font-size: 10px; color: #999; margin-bottom: 30px;">※上記ランキングは著者ランキングと比較し、更新に時間を要する場合がございます。</p>

            <h2 style="font-size: 18px; font-weight: bold;">{{ customer.nickname }}さんの地域ランキング</h2>

            <div class="section-headline">大宮・与野周辺の口コミ数(2026年1月)ランキング</div>
            <div class="reviewer-grid">
                <div class="reviewer-item">
                    <span class="rank-badge">1</span>
                    <img src="https://via.placeholder.com/90" alt="udaik" class="reviewer-img" width="90" height="90">
                    <a href="#" class="reviewer-name">udaik</a>
                    <div class="count-val">16件</div>
                </div>
                <div class="reviewer-item">
                    <span class="rank-badge silver">2</span>
                    <img src="https://via.placeholder.com/90" alt="chikaaa220" class="reviewer-img" width="90"
                        height="90">
                    <a href="#" class="reviewer-name">chikaaa220</a>
                    <div class="count-val">12件</div>
                </div>
                <div class="reviewer-item">
                    <span class="rank-badge silver">2</span>
                    <img src="https://via.placeholder.com/90" alt="jing666" class="reviewer-img" width="90" height="90">
                    <a href="#" class="reviewer-name">jing666</a>
                    <div class="count-val">12件</div>
                </div>
            </div>
            <div style="text-align: right;"><a href="#" style="color: #06c; font-size: 11px;">▶ 大宮・与野周辺のランキングをもっと見る</a>
            </div>

            <section class="link-section">
                <h3 id="region-list-title" style="font-size: 16px; margin-bottom: 10px;">地域ランキング</h3>
                <table class="link-table" aria-labelledby="region-list-title">
                    <caption>都道府県別のレビュアーランキングリンク一覧</caption>
                    <tr>
                        <th>北海道・東北</th>
                        <td><a href="#">北海道</a> <a href="#">青森</a> <a href="#">秋田</a> <a href="#">山形</a> <a
                                href="#">岩手</a> <a href="#">宮城</a> <a href="#">福島</a></td>
                    </tr>
                    <tr>
                        <th>関東</th>
                        <td><a href="#">東京</a> <a href="#">神奈川</a> <a href="#">埼玉</a> <a href="#">千葉</a> <a
                                href="#">栃木</a> <a href="#">茨城</a> <a href="#">群馬</a></td>
                    </tr>
                </table>
            </section>
            {% endif %}
            {% endif %}
        </main>

        <aside class="ranking-sidebar">
            <div class="sidebar-box">
                <div class="user-profile">
                    <div class="profile-img-placeholder">
                        {% if customer.icon_image %}
                        <img src="{{ customer.icon_image.url }}" alt="アイコン" style="width: 40px; height: 40px; object-fit: cover;">
                        {% endif %}
                    </div>
                    <div style="font-weight: bold;">{{ customer.nickname }} <span>さん</span></div>
                </div>

                <ul class="sidebar-nav-list">
                    <li><a href="{% url 'reviews:customer_reviewer_detail' %}">マイページ</a></li>
                    <li><a href="{% url 'reviews:customer_reviewer_review_list' %}">公開中口コミ一覧</a></li>
                    <li><a href="{% url 'follows:customer_follow_list' %}">フォロー中</a></li>
                    <li><a href="{% url 'reviews:customer_store_preserve' %}">保存リスト</a></li>
                </ul>
            </div>
        </aside>
    </div>
</div>
{% endblock %}

<a href="{% url 'reviews:customer_reviewer_detail'%}">マイページ</a>
<a href="{% url 'reviews:customer_reviewer_review_list' %}">レビュアー口コミ一覧</a>
<a href="{% url 'follows:customer_follow_list' %}">フォロー中一覧</a>
<a href="{% url 'follows:customer_follower_list' %}">フォロワー一覧</a>
