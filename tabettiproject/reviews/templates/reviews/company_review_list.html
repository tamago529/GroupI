<!--å£ã‚³ãƒŸä¸€è¦§(ä¼æ¥­ç”»é¢)  -->
{% extends "company_base.html" %}

{% block content %}
<style>
    /* 1. å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .review-manage-wrapper {
        max-width: 1000px;
        margin: 40px auto;
        padding: 0 20px;
        font-family: sans-serif;
    }

    .page-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 25px;
        color: #333;
        border-left: 5px solid #ff9600; 
        padding-left: 15px;
    }

    /* 2. ãƒ•ã‚£ãƒ«ã‚¿ã‚¨ãƒªã‚¢ï¼ˆé€šå ±æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰ */
    .filter-section {
        background-color: #f8f9fa;
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        border: 1px solid #eee;
    }

    .filter-label {
        font-weight: bold;
        color: #555;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å°‘ã—å¤§ããæŠ¼ã—ã‚„ã™ã */
    .filter-label input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    /* 3. å£ã‚³ãƒŸãƒªã‚¹ãƒˆ */
    .review-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .review-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        transition: box-shadow 0.2s;
    }

    .review-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    /* å£ã‚³ãƒŸã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„æ˜Ÿï¼‰ */
    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .user-info {
        display: flex;
        flex-direction: column;
    }

    .user-name {
        font-weight: bold;
        font-size: 16px;
        color: #333;
    }

    .review-date {
        font-size: 12px;
        color: #888;
    }

    /* æ˜Ÿè©•ä¾¡ã®è¦‹ãŸç›® */
    .rating-stars {
        color: #ff9600;
        font-size: 18px;
        font-weight: bold;
    }

    /* å£ã‚³ãƒŸæœ¬æ–‡ */
    .review-body {
        font-size: 15px;
        line-height: 1.6;
        color: #444;
        margin-bottom: 15px;
    }

    /* é€šå ±æ¸ˆã¿ãƒãƒƒã‚¸ */
    .reported-badge {
        display: inline-block;
        background-color: #fff2f2;
        color: #d9534f;
        border: 1px solid #d9534f;
        padding: 2px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }

    /* 4. æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
    .footer-nav {
        margin-top: 40px;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }

    .btn-back {
        display: inline-block;
        padding: 10px 30px;
        border: 2px solid #333;
        background-color: #fff;
        color: #333;
        text-decoration: none;
        font-weight: bold;
        border-radius: 5px;
    }

    .btn-back:hover {
        background-color: #f0f0f0;
    }
</style>

<div class="review-manage-wrapper">
    <h1 class="page-title">å£ã‚³ãƒŸé–²è¦§ï¼ˆç®¡ç†ï¼‰</h1>

    <!-- ãƒ•ã‚£ãƒ«ã‚¿ã‚¨ãƒªã‚¢ -->
    <div class="filter-section">
        <label class="filter-label">
            <input type="checkbox" name="reported" value="1" id="reportedFilter" onchange="toggleFilter()">
            <span>é€šå ±æ¸ˆã¿ã®ã¿è¡¨ç¤º</span>
        </label>
    </div>

    <!-- å£ã‚³ãƒŸä¸€è¦§ -->
    <div class="review-list">
        {% for review in reviews %}
    <!-- 
        JSã®çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã®ãŸã‚ã«ã€é€šå ±ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ 'is-reported' ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ã—ã¾ã™ 
    -->
    <div class="review-card {% if review.id in reported_review_ids %}is-reported{% endif %}">
        <div class="review-header">
            <div class="user-info">
                <span class="user-name">{{ review.reviewer.nickname }} ã•ã‚“</span>
                <span class="review-date">{{ review.posted_at|date:"Y/m/d H:i" }}</span>
            </div>
            <div class="rating-stars">â˜… {{ review.score }}</div>
        </div>
        <div class="review-body">
            {{ review.review_text|linebreaksbr }}
        </div>
        <div style="font-size: 0.8em; color: #666;">å¯¾è±¡åº—èˆ—ï¼š{{ review.store.store_name }}</div>
        
        <!-- é€šå ±ãƒãƒƒã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã‹åˆ¤å®š -->
        {% if review.id in reported_review_ids %}
            <span class="reported-badge">ğŸš© é€šå ±ã‚ã‚Š</span>
        {% endif %}
    </div>
    {% empty %}
        <p>å£ã‚³ãƒŸã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
</div>

    <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div class="footer-nav">
        <a href="{% url 'accounts:company_top' %}" class="btn-back">é‹ç”¨ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
    </div>
</div>

<script>
    /**
     * JSã®è§£èª¬ï¼š
     * ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆãŸæ™‚ã«ã€é€šå ±ã•ã‚Œã¦ã„ãªã„ã‚«ãƒ¼ãƒ‰ã‚’
     * æ¶ˆã—ãŸã‚Šï¼ˆéš ã—ãŸã‚Šï¼‰å‡ºã—ãŸã‚Šã™ã‚‹ã‚¹ã‚¤ãƒƒãƒã®å½¹å‰²ã‚’ã—ã¾ã™ã€‚
     */
    function toggleFilter() {
        // 1. ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—ï¼ˆãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã‚‹ã‹ï¼Ÿï¼‰
        const isChecked = document.getElementById('reportedFilter').checked;
        
        // 2. å…¨ã¦ã®å£ã‚³ãƒŸã‚«ãƒ¼ãƒ‰ã‚’å–å¾—
        const cards = document.querySelectorAll('.review-card');

        // 3. å„ã‚«ãƒ¼ãƒ‰ã‚’1ã¤ãšã¤ãƒã‚§ãƒƒã‚¯ã—ã¦éš ã™ã‹æ±ºã‚ã‚‹
        cards.forEach(card => {
            // ã€Œé€šå ±æ¸ˆã¿ã€ã¨ã„ã†ç›®å°ï¼ˆis-reportedã‚¯ãƒ©ã‚¹ï¼‰ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª
            const isReported = card.classList.contains('is-reported');

            if (isChecked) {
                // ã€Œé€šå ±æ¸ˆã¿ã®ã¿è¡¨ç¤ºã€ãŒONã®ã¨ãã€é€šå ±ã•ã‚Œã¦ãªã„ã‚«ãƒ¼ãƒ‰ã‚’éš ã™
                if (!isReported) {
                    card.style.display = 'none';
                }
            } else {
                // ãƒã‚§ãƒƒã‚¯ãŒOFFãªã‚‰ã€å…¨éƒ¨è¡¨ç¤ºã™ã‚‹
                card.style.display = 'block';
            }
        });
    }
</script>
{% endblock %}