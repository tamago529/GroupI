<!--å£ã‚³ãƒŸä¸€è¦§(ä¼æ¥­ç”»é¢)  -->
{% extends "company_base.html" %}

{% block content %}
<style>
    /* 1. å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .review-manage-wrapper {
        max-width: 1000px;
        margin: 40px auto;
        padding: 0 20px;
        font-family: sans-serif;
        width: 100%;
        box-sizing: border-box;
    }

    .page-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 25px;
        color: #333;
        border-left: 5px solid #ff9600;
        padding-left: 15px;
    }

    /* 2. ãƒ•ã‚£ãƒ«ã‚¿ã‚¨ãƒªã‚¢ï¼ˆé€šå ±æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰ */
    .filter-section {
        background-color: #f8f9fa;
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        border: 1px solid #eee;
        width: 100%;
        box-sizing: border-box;
    }

    .filter-label {
        font-weight: bold;
        color: #555;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-label input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    /* 3. å£ã‚³ãƒŸãƒªã‚¹ãƒˆ */
    .review-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 100%;
        box-sizing: border-box;
    }

    .review-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        transition: box-shadow 0.2s;
        width: 100%;
        box-sizing: border-box;
    }

    .review-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    /* å£ã‚³ãƒŸã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„æ˜Ÿï¼‰ */
    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
        gap: 12px;
    }

    .user-info {
        display: flex;
        flex-direction: column;
        min-width: 0; /* ã¯ã¿å‡ºã—å¯¾ç­– */
    }

    .user-name {
        font-weight: bold;
        font-size: 16px;
        color: #333;
    }

    .review-date {
        font-size: 12px;
        color: #888;
    }

    .rating-stars {
        color: #ff9600;
        font-size: 18px;
        font-weight: bold;
        white-space: nowrap;
    }

    /* å£ã‚³ãƒŸæœ¬æ–‡ */
    .review-body {
        font-size: 15px;
        line-height: 1.6;
        color: #444;
        margin-bottom: 15px;

        /* é•·ã„æ–‡å­—åˆ—ã§æ¨ªãŒä¼¸ã³ã‚‹ã®ã‚’é˜²ã */
        overflow-wrap: anywhere;
        word-break: break-word;
    }

    /* é€šå ±æ¸ˆã¿ãƒãƒƒã‚¸ */
    .reported-badge {
        display: inline-block;
        background-color: #fff2f2;
        color: #d9534f;
        border: 1px solid #d9534f;
        padding: 2px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-top: 8px;
    }

    /* å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼ˆå„ã‚«ãƒ¼ãƒ‰å³ä¸‹ï¼‰ */
    .review-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 12px;
    }

    .btn-delete {
        display: inline-block;
        padding: 8px 14px;
        border: 2px solid #d9534f;
        color: #d9534f;
        background: #fff;
        border-radius: 6px;
        font-weight: bold;
        text-decoration: none;
        font-size: 13px;
    }

    .btn-delete:hover {
        background: #fff2f2;
    }

    /* 4. æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
    .footer-nav {
        margin-top: 40px;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }

    .btn-back {
        display: inline-block;
        padding: 10px 30px;
        border: 2px solid #333;
        background-color: #fff;
        color: #333;
        text-decoration: none;
        font-weight: bold;
        border-radius: 5px;
    }

    .btn-back:hover {
        background-color: #f0f0f0;
    }
</style>

<div class="review-manage-wrapper">
    <h1 class="page-title">å£ã‚³ãƒŸé–²è¦§ï¼ˆç®¡ç†ï¼‰</h1>

    <!-- ãƒ•ã‚£ãƒ«ã‚¿ã‚¨ãƒªã‚¢ -->
    <div class="filter-section">
        <label class="filter-label">
            {# â˜…ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã¯ã‚µãƒ¼ãƒã‹ã‚‰æ¸¡ã•ã‚ŒãŸ only_reported ã§åˆ¶å¾¡ #}
            <input
                type="checkbox"
                name="reported"
                value="1"
                id="reportedFilter"
                onchange="toggleFilter()"
                {% if only_reported %}checked{% endif %}
            >
            <span>é€šå ±æ¸ˆã¿ã®ã¿è¡¨ç¤º</span>
        </label>
    </div>

    <!-- å£ã‚³ãƒŸä¸€è¦§ -->
    <div class="review-list">
        {% for review in reviews %}
            <div class="review-card {% if review.id in reported_review_ids %}is-reported{% endif %}">
                <div class="review-header">
                    <div class="user-info">
                        <span class="user-name">{{ review.reviewer.nickname }} ã•ã‚“</span>
                        <span class="review-date">{{ review.posted_at|date:"Y/m/d H:i" }}</span>
                    </div>
                    <div class="rating-stars">â˜… {{ review.score }}</div>
                </div>

                <div class="review-body">
                    {{ review.review_text|linebreaksbr }}
                </div>

                <div style="font-size: 0.8em; color: #666;">
                    å¯¾è±¡åº—èˆ—ï¼š{{ review.store.store_name }}
                </div>

                {% if review.id in reported_review_ids %}
                    <span class="reported-badge">ğŸš© é€šå ±æ¸ˆã¿</span>
                {% endif %}

                <!-- âœ… å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆå„ã‚«ãƒ¼ãƒ‰å³ä¸‹ï¼‰ -->
                <div class="review-actions">
                    <a class="btn-delete"
                       href="{% url 'commons:review_delete_confirm' review.pk %}?next={{ request.get_full_path|urlencode }}">
                        å‰Šé™¤
                    </a>
                </div>
            </div>
        {% empty %}
            {% if only_reported %}
                <p>é€šå ±æ¸ˆã¿ã®å£ã‚³ãƒŸã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% else %}
                <p>å£ã‚³ãƒŸã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
        {% endfor %}
    </div>

    <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div class="footer-nav">
        <a href="{% url 'accounts:company_top' %}" class="btn-back">é‹ç”¨ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
    </div>
</div>

<script>
    // âœ… ãƒã‚§ãƒƒã‚¯ON/OFFã§ã‚µãƒ¼ãƒã«å–ã‚Šã«è¡Œãï¼ˆGETãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ‡æ›¿ï¼‰
    function toggleFilter() {
        const isChecked = document.getElementById('reportedFilter').checked;
        const url = new URL(window.location.href);

        if (isChecked) {
            url.searchParams.set('reported', '1');
        } else {
            url.searchParams.set('reported', '0');
            // ã‚‚ã—ãã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤ã§ã‚‚OK
            // url.searchParams.delete('reported');
        }

        window.location.href = url.toString();
    }
</script>
{% endblock %}
