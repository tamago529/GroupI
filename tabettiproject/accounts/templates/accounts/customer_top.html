{% extends 'customer_base.html' %}
{% load static %}

{% block title %}タベッチ - グルメ・レストランレビュー{% endblock %}

{% block css %}
<style>
  /* =========================
   ヒーロー
========================= */
  .hero {
    position: relative;
    width: 100%;
    height: 690px;
    overflow: hidden;
    background-color: #000;
  }

  .hero-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    animation: hero-fade 15s infinite;
  }

  .hero-image:nth-of-type(1) {
    animation-delay: 0s;
  }

  .hero-image:nth-of-type(2) {
    animation-delay: 5s;
  }

  .hero-image:nth-of-type(3) {
    animation-delay: 10s;
  }

  @keyframes hero-fade {
    0% {
      opacity: 0;
    }

    10% {
      opacity: 1;
    }

    33% {
      opacity: 1;
    }

    43% {
      opacity: 0;
    }

    100% {
      opacity: 0;
    }
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #fff;
    background: rgba(0, 0, 0, 0.25);
  }

  .hero-overlay h1 {
    font-size: 36px;
    font-weight: bold;
    margin-bottom: 12px;
  }

  .hero-overlay p {
    font-size: 18px;
  }

  /* =========================
   メイン
========================= */
  .main-container {
    max-width: 1180px;
    margin: 0 auto;
    padding: 32px 16px;
  }

  .section {
    margin-bottom: 48px;
  }

  .section-title {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 16px;
    padding-left: 8px;
    border-left: 6px solid #ff8a00;
  }

  /* ===== カード ===== */
  .cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 18px;
  }

  .card {
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }

  .card img {
    width: 100%;
    height: 130px;
    object-fit: cover;
  }

  .card-body {
    padding: 12px;
    text-align: center;
  }

  .card-title {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 6px;
  }

  .card-sub {
    font-size: 14px;
    color: #666;
  }

  /* ===== ジャンル ===== */
  .genres {
    display: flex;
    gap: 16px;
    width: 100%;
    flex-wrap: wrap;
  }

  .genre-card {
    flex: 1;
    min-width: 150px;

    background: #fff;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    text-align: center;
    padding: 12px 6px;

    /* Link Reset */
    display: block;
    text-decoration: none;
    color: inherit;
    transition: opacity 0.2s;
  }

  .genre-card:hover {
    opacity: 0.8;
  }

  .genre-card img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    border-radius: 4px;
    margin-bottom: 8px;
  }

  .genre-card span {
    font-size: 14px;
    font-weight: bold;
  }

  /* ✅ 追加：ジャンル一覧へ（枠なし・青） */
  .genre-actions {
    display: flex;
    justify-content: flex-end;
    margin: 12px 0 0 0;
  }

  .genre-list-btn {
    display: inline-block;
    padding: 0;
    /* 枠がないので余白は最低限でOK */
    border: none;
    /* ✅ 枠なし */
    background: transparent;
    /* ✅ 背景なし */
    color: #1e73c9;
    /* ✅ 青 */
    font-size: 14px;
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
  }

  .genre-list-btn:hover {
    text-decoration: underline;
    /* hoverだけ下線 */
  }

  .genre-list-btn:focus-visible {
    outline: none;
    text-decoration: underline;
  } 

  /* ===== 利用シーン ===== */
  .scenes {
    display: flex;
    gap: 16px;
    width: 100%;
    flex-wrap: nowrap;          /* ✅ 折り返さない＝横一列 */
    overflow-x: auto;           /* ✅ 画面に収まらなければ横スクロール */
    -webkit-overflow-scrolling: touch;
    padding-bottom: 6px;        /* スクロールバーとの干渉軽減 */
  }

  .scene-card {
    flex: 0 0 auto;             /* ✅ 均等伸縮させず固定 */
    width: 120px;               /* ✅ 正方形サイズ（好みで調整OK） */
    text-decoration: none;
    color: inherit;
    transition: opacity 0.2s;
    text-align: center;
  }

  .scene-card:hover { opacity: 0.85; }

  .scene-card img {
    width: 120px;
    height: 120px;              /* ✅ 正方形 */
    object-fit: cover;
    border-radius: 10px;
    display: block;
    background: #f2f2f2;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .scene-card span {
    display: block;
    margin-top: 8px;
    font-size: 13px;
    font-weight: 700;
    white-space: nowrap;        /* ✅ 2行にしない */
  }

  /* =========================
   評価（SVG / 半星）
  ========================= */
  .stars-svg {
    display: flex;
    gap: 2px;
    line-height: 0;
  }
  .svgstar {
    width: 14px;
    height: 14px;
    display: inline-flex;
  }
  .svgstar svg { width: 100%; height: 100%; display: block; }
  .svgstar.full use { fill: #ffa500; }
  .svgstar.empty use { fill: #ddd; }
  .svgstar.half use { fill: url(#halfGrad); }
    /* ===== エリア（追加） ===== */
    .area-major-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    @media (min-width: 768px) {
      .area-major-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .area-card {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 16/11;
      display: block;
      text-decoration: none;
    }
    .area-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .area-card:hover img {
      transform: scale(1.05);
    }
    .area-card-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.6));
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 12px;
    }
    .area-name {
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0,0,0,0.6);
      letter-spacing: 0.05em;
    }

    .area-other-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .area-text-link {
      display: inline-block;
      padding: 8px 14px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-decoration: none;
      color: #555;
      font-size: 13px;
      transition: 0.2s;
    }
    .area-text-link:hover {
      background: #ececec;
      color: #333;
    }

  </style>
{% endblock %}

{% block content %}

{# ===== SVG定義（半星グラデ + 星形） ===== #}
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="halfGrad" x1="0" y1="0" x2="1" y2="0">
      <stop offset="50%" stop-color="#ffa500"/>
      <stop offset="50%" stop-color="#ddd"/>
    </linearGradient>

    <symbol id="icon-star" viewBox="0 0 24 24">
      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/>
    </symbol>
  </defs>
</svg>

<!-- ===== ヒーロー ===== -->
<div class="hero">
  <img src="{% static 'images/red.png' %}" alt="" class="hero-image">
  <img src="{% static 'images/blue.jpg' %}" alt="" class="hero-image">
  <img src="{% static 'images/green.jpg' %}" alt="" class="hero-image">

  <div class="hero-overlay">
    <h1>行きたいお店が、きっと見つかる</h1>
    <p>日本最大級のグルメレビューサイト</p>
  </div>
</div>

<div class="main-container">

  <!-- 特集 -->
  <section class="section">
    <div class="section-title">特集・注目コンテンツ</div>
    <div class="cards">
      <a href="{% url 'search:customer_search_list' %}?sort=rating" class="card"
        style="text-decoration:none; color:inherit; display:block;">
        <img src="{% static 'images/award.jpg' %}">
        <div class="card-body">
          <div class="card-title">The Tabecchi Award 2026</div>
          <div class="card-sub">ユーザー評価の高い受賞店</div>
        </div>
      </a>

      <a href="{% url 'search:customer_search_list' %}?sort=reviews" class="card"
        style="text-decoration:none; color:inherit; display:block;">
        <img src="{% static 'images/hot_restaurants.jpg' %}">
        <div class="card-body">
          <div class="card-title">ホットレストラン</div>
          <div class="card-sub">今注目の人気店</div>
        </div>
      </a>

      <a href="{% url 'search:customer_genre_list' %}" class="card"
        style="text-decoration:none; color:inherit; display:block;">
        <img src="{% static 'images/genre.jpg' %}">
        <div class="card-body">
          <div class="card-title">ジャンル特集</div>
          <div class="card-sub">料理ジャンル別に探す</div>
        </div>
      </a>
    </div>
  </section>

  <!-- ジャンル -->
  <section class="section">
    <div class="section-title">料理ジャンルから探す</div>

    <div class="genres">
      <a href="{% url 'search:customer_search_list' %}?keyword=寿司" class="genre-card">
        <img src="{% static 'images/sushi.jpg' %}"><span>寿司</span>
      </a>
      <a href="{% url 'search:customer_search_list' %}?keyword=ラーメン" class="genre-card">
        <img src="{% static 'images/ramen.jpg' %}"><span>ラーメン</span>
      </a>
      <a href="{% url 'search:customer_search_list' %}?keyword=焼肉" class="genre-card">
        <img src="{% static 'images/yakiniku.jpg' %}"><span>焼肉</span>
      </a>
      <a href="{% url 'search:customer_search_list' %}?keyword=カフェ" class="genre-card">
        <img src="{% static 'images/cafe.jpg' %}"><span>カフェ</span>
      </a>
      <a href="{% url 'search:customer_search_list' %}?keyword=居酒屋" class="genre-card">
        <img src="{% static 'images/izakaya.jpg' %}"><span>居酒屋</span>
      </a>
    </div>

    <!-- ✅ 追加：ジャンル一覧へ（枠なし・青） -->
    <div class="genre-actions">
      <a class="genre-list-btn" href="{% url 'search:customer_genre_list' %}">
        ＜＜ジャンル一覧へ
      </a>
    </div>
  </section>

  <!-- エリアから探す -->
  <section class="section">
    <div class="section-title">エリアから探す</div>
    
    <!-- 主要エリア（写真付きグリッド） -->
    <div class="area-major-grid">
      {% for area in major_areas %}
        <a href="{% url 'search:customer_search_list' %}?area={{ area.area_name }}" class="area-card">
           <img src="{% static area.image_static %}" alt="{{ area.area_name }}">
           <div class="area-card-overlay">
             <span class="area-name">{{ area.area_name }}</span>
           </div>
        </a>
      {% endfor %}
    </div>

    <!-- その他エリア（テキストリンク） -->
    <div class="area-other-list">
      {% for area in other_areas %}
        <a href="{% url 'search:customer_search_list' %}?area={{ area.area_name }}" class="area-text-link">
           {{ area.area_name }}
        </a>
      {% endfor %}
    </div>
  </section>

    <!-- 利用シーン -->
  <section class="section">
    <div class="section-title">利用シーンから探す</div>

    <div class="scenes">
      {% for s in scenes %}
        <a href="{% url 'search:customer_search_list' %}?scene={{ s.id }}" class="scene-card">
          <img src="{% static s.image_static %}" alt="{{ s.scene_name }}">
          <span>{{ s.scene_name }}</span>
        </a>
      {% endfor %}
    </div>
  </section>


  <!-- ランキング -->
  <section class="section">
    <div class="section-title">人気ランキング</div>
    <div class="cards">
      {% for store in ranking_stores %}
      <a href="{% url 'stores:customer_store_info' store.pk %}" class="card"
         style="text-decoration:none; color:inherit; display:block;">
        
        {# 店舗画像があれば表示、なければデフォルト #}
        {% if store.images.all %}
           <img src="{{ store.images.first.image_file.url }}" alt="{{ store.store_name }}">
        {% else %}
           <img src="{% static 'images/no_image.png' %}" alt="No Image" style="object-fit:cover; background:#f0f0f0;">
        {% endif %}

        <div class="card-body">
          <div class="card-title">{{ forloop.counter }}位 {{ store.store_name }}</div>
          
          <div style="display:flex; flex-direction:column; align-items:center; gap:4px; margin-top:8px;">
             <!-- 星表示 -->
             <div class="stars-svg" aria-label="店舗評価">
               {% for s in store.star_states %}
                 <span class="svgstar {{ s }}">
                   <svg viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-star"></use></svg>
                 </span>
               {% endfor %}
             </div>
             
             <div style="font-size:13px; color:#ff8a00; font-weight:bold;">
               {{ store.avg_rating_val|floatformat:1 }} <span style="color:#666; font-weight:normal; font-size:12px; margin-left:6px;">{{ store.area.area_name }}</span>
             </div>
          </div>

        </div>
      </a>
      {% empty %}
        <p>ランキングデータがまだありません。</p>
      {% endfor %}
    </div>
  </section>

  <!-- 星の合計獲得数ランキング -->
  <section class="section">
    <div class="section-title">星の合計獲得数ランキング</div>
    <div class="cards">
      {% for store in total_star_stores %}
      <a href="{% url 'stores:customer_store_info' store.pk %}" class="card"
         style="text-decoration:none; color:inherit; display:block;">
        
        {% if store.images.all %}
           <img src="{{ store.images.first.image_file.url }}" alt="{{ store.store_name }}">
        {% else %}
           <img src="{% static 'images/no_image.png' %}" alt="No Image" style="object-fit:cover; background:#f0f0f0;">
        {% endif %}

        <div class="card-body">
          <div class="card-title">{{ forloop.counter }}位 {{ store.store_name }}</div>
          
          <div style="display:flex; flex-direction:column; align-items:center; gap:4px; margin-top:8px;">
             <!-- 星表示 -->
             <div class="stars-svg" aria-label="店舗評価">
               {% for s in store.star_states %}
                 <span class="svgstar {{ s }}">
                   <svg viewBox="0 0 24 24" aria-hidden="true"><use href="#icon-star"></use></svg>
                 </span>
               {% endfor %}
             </div>
             
             <div style="font-size:13px; color:#ff8a00; font-weight:bold;">
               ★{{ store.avg_rating_val|floatformat:1 }} 
               <span style="color:#666; font-weight:normal; font-size:12px; margin-left:6px;">獲得星数: {{ store.total_score_val|default:0 }}</span>
             </div>
          </div>

        </div>
      </a>
      {% empty %}
        <p>ランキングデータがまだありません。</p>
      {% endfor %}
    </div>
  </section>

  <!-- 店舗登録プロモーション -->
  <section class="section" style="border-top: 1px solid #eee; padding-top: 40px;">
    <div style="background: linear-gradient(135deg, #fff 0%, #fffbf2 100%); padding: 30px; border-radius: 8px; border: 1px solid #ffe8cc; text-align: center;">
      <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 12px; color: #333;">掲載されていない店舗を見つけましたか？</h3>
      <p style="margin-bottom: 20px; color: #666; font-size: 15px;">新しいお店の情報を登録して、みんなと共有しましょう。</p>
      <a href="{% url 'stores:customer_store_new_register' %}" 
         style="display: inline-block; padding: 12px 40px; background: #ff8a00; color: #fff; text-decoration: none; border-radius: 4px; font-weight: bold; font-size: 16px; transition: background 0.2s;">
         店舗を登録する
      </a>
    </div>
  </section>

  <!-- ユーザー検索 -->
  <section class="section" style="border-top: 1px solid #eee; padding-top: 40px;">
    <div class="section-title">ユーザーを探す</div>
    <div style="background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center;">
      <p style="margin-bottom: 20px; color: #666; font-size: 15px;">気になるレビュアーや友人を検索してみましょう。</p>
      <form action="{% url 'search:customer_user_search_list' %}" method="get" style="display: flex; justify-content: center; gap: 10px; max-width: 600px; margin: 0 auto;">
        <input type="text" name="keyword" placeholder="ユーザー名・ニックネームを入力" style="flex: 1; padding: 12px 16px; border: 1px solid #ddd; border-radius: 4px; font-size: 15px;">
        <button type="submit" style="padding: 12px 30px; background: #ff8a00; color: #fff; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;">検索</button>
      </form>
    </div>
  </section>

</div>
{% endblock %}