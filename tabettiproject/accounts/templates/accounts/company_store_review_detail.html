{% extends 'company_base.html' %}

{% block content %}
<style>
/* ===== Layout ===== */
.detail-container{
  max-width:1000px;
  margin:40px auto;
  padding:0 20px;
  font-family:sans-serif;
}
.detail-title{
  font-size:24px;
  margin-bottom:30px;
  border-left:5px solid #ff9600;
  padding-left:15px;
}

/* ===== Upper Section ===== */
.info-section{
  display:flex;
  gap:30px;
  margin-bottom:40px;
  align-items:flex-start;
}

/* Info Box */
.info-box{
  flex:1;
  border:2px solid #333;
  padding:20px;
  background:#fff;
}
.info-box h3{
  margin-top:0;
  margin-bottom:15px;
}
.info-box p{
  font-size:14px;
  margin:6px 0;
}

/* Image Box */
.image-box{
  flex:1.5;
  border:2px solid #333;
  padding:20px;
  background:#f9f9f9;
  text-align:center;
}
.image-box h3{
  margin-top:0;
}
.license-img{
  max-width:100%;
  height:auto;
  border:1px solid #ccc;
  margin-top:15px;
}

/* ===== Bottom ===== */
.bottom-actions{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.right-buttons{
  display:flex;
  gap:15px;
}

/* ===== Buttons ===== */
.btn{
  padding:12px 28px;
  border:2px solid #333;
  background:#fff;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
  text-decoration:none;
  color:#000;
}
.btn:hover{
  background:#f0f0f0;
}
.btn-permit:hover{
  background:#ff9600;
  color:#fff;
}

/* ===== Modal ===== */
.modal-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal-content{
  background:#fff;
  padding:40px;
  border:2px solid #333;
  border-radius:10px;
  text-align:center;
}
</style>

<div class="detail-container">

  <h1 class="detail-title">店舗アカウント審査詳細</h1>

  <div class="info-section">
    <!-- ① 申請情報 -->
    <div class="info-box">
      <h3>① 申請情報</h3>
      <p><strong>店舗名：</strong>{{ req.store_name }}{% if req.branch_name %} {{ req.branch_name }}{% endif %}</p>
      <p><strong>申請者：</strong>{{ req.applicant_name }}</p>
      <p><strong>店舗との関係：</strong>{{ req.relation_to_store }}</p>
      <p><strong>所在地：</strong>{{ req.address }}</p>
      <p><strong>申請日時：</strong>{{ req.requested_at|date:"Y-m-d H:i" }}</p>
      <p><strong>ステータス：</strong>{{ req.request_status.status }}</p>
    </div>

    <!-- ② 営業許可証 -->
    <div class="image-box">
      <h3>② 営業許可証（画像）</h3>

      {% if req.license_image %}
        <img
          class="license-img"
          src="{{ req.license_image.url }}"
          alt="営業許可証">
      {% else %}
        <p style="margin-top:20px; color:#888;">
          画像がアップロードされていません
        </p>
      {% endif %}
    </div>
  </div>

  <!-- Buttons -->
  <div class="bottom-actions">
    <a href="{% url 'accounts:company_store_review' %}" class="btn">
      戻る
    </a>

    <div class="right-buttons">
      <button class="btn btn-permit" onclick="showPopup()">許可</button>
      <a href="#" class="btn">不可</a>
    </div>
  </div>
</div>

<!-- Permit Modal -->
<div class="modal-overlay" id="permitModal">
  <div class="modal-content">
    <h2>確認</h2>
    <p>この店舗アカウントを許可してもよろしいですか？</p>
    <div style="margin-top:20px; display:flex; gap:12px; justify-content:center;">
      <button class="btn" type="button" onclick="closePopup()">キャンセル</button>
      <!-- 次はここを POST にする -->
      <form method="post" action="{% url 'accounts:company_store_review_permit' req.id %}">
        {% csrf_token %}
        <button class="btn btn-permit" type="submit">実行する</button>
      </form>

      <form method="post" action="{% url 'accounts:company_store_review_reject' req.id %}">
        {% csrf_token %}
        <button class="btn" type="submit">却下する</button>
      </form>
    </div>
  </div>
</div>

<script>
function showPopup(){
  document.getElementById('permitModal').style.display = 'flex';
}
function closePopup(){
  document.getElementById('permitModal').style.display = 'none';
}
</script>

{% endblock %}
